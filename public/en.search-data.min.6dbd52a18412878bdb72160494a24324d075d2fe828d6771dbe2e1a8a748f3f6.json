[{"id":0,"href":"/ITWorks/docs/kdatastore/en/","title":"English","section":"KDataStore","content":" Basic feature preview # view-kt view-java compose Setup # Get a sample or configure as below.\nview groovy //region KDataStore android.lintOptions.disable \u0026#39;NonConstantResourceId\u0026#39; tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach{ kotlinOptions.freeCompilerArgs += \u0026#39;-Xcontext-receivers\u0026#39; } dependencies { implementation \u0026#39;io.github.shawxingkwok:kt-util:1.0.0\u0026#39; implementation \u0026#39;io.github.shawxingkwok:android-util-view:1.0.0\u0026#39; implementation \u0026#39;io.github.shawxingkwok:android-kdatastore:1.0.0\u0026#39; } //endregion kotlin //region KDataStore android.lintOptions.disable (\u0026#34;NonConstantResourceId\u0026#34;) tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach{ kotlinOptions.freeCompilerArgs += \u0026#34;-Xcontext-receivers\u0026#34; } dependencies { implementation (\u0026#34;io.github.shawxingkwok:kt-util:1.0.0\u0026#34;) implementation (\u0026#34;io.github.shawxingkwok:android-util-view:1.0.0\u0026#34;) implementation (\u0026#34;io.github.shawxingkwok:android-kdatastore:1.0.0\u0026#34;) } //endregion compose groovy //region KDataStore android.lintOptions.disable \u0026#39;NonConstantResourceId\u0026#39; tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach{ kotlinOptions.freeCompilerArgs += \u0026#39;-Xcontext-receivers\u0026#39; } dependencies { implementation \u0026#39;io.github.shawxingkwok:kt-util:1.0.0\u0026#39; implementation \u0026#39;io.github.shawxingkwok:android-kdatastore-compose:1.0.0\u0026#39; } //endregion kotlin //region KDataStore android.lintOptions.disable (\u0026#34;NonConstantResourceId\u0026#34;) tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach{ kotlinOptions.freeCompilerArgs += \u0026#34;-Xcontext-receivers\u0026#34; } dependencies { implementation (\u0026#34;io.github.shawxingkwok:kt-util:1.0.0\u0026#34;) implementation (\u0026#34;io.github.shawxingkwok:android-kdatastore-compose:1.0.0\u0026#34;) } //endregion Core Usage # Set data model # Update # // suspend Settings.isDarkMode.emit(true) Settings.isDarkMode.emit{ !it } That type Flow is declared inside class KDataStore and extends from the official Flow, being both collectable and mutable.\nCollect # view I suggest my collectOnResume if in Fragment.\nclass MainFragment : Fragment(){ override fun onViewCreated(view: View, savedInstanceState: Bundle?) { super.onViewCreated(view, savedInstanceState) Settings.isDarkMode.collectOnResume{ switch.isChecked = it } } } compose I suggest my flow state extension.\nuse Kotlin serialization # Usage # It\u0026rsquo;s an official platform-neutral data conversion, and directly savable in my KDataStore.\nimport kotlinx.serialization.Serializable import pers.shawxingkwok.kdatastore.KDataStore @Serializable data class Data(val a: Int, val b: String) object MDataStore: KDataStore(){ val data by ktSerializable(Data(1, \u0026#34;\u0026#34;)) } Config # Groovy plugins{ id \u0026#39;kotlinx-serialization\u0026#39; version \u0026#34;$kt_version\u0026#34; } dependencies { implementation \u0026#39;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.0\u0026#39; } Kotlin plugins{ id (\u0026#34;kotlinx-serialization\u0026#34;) version (\u0026#34;$kt_version\u0026#34;) } dependencies { implementation (\u0026#34;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.0\u0026#34;) } Migration # There is a protected context inside KDataStore for you to get other stores like SharedPreferences, DataStore.\nEncryption # default encrypted\nThis encryption part references https://github.com/MFlisar/MaterialPreferences. Options # scope # TODO(handlerScope, ioScope)\nfile name # Details # Reset # updateAll # GitHub repo # "},{"id":1,"href":"/ITWorks/docs/ktutil/","title":"Kt Util","section":"Docs","content":" Setup # implementation \u0026#34;io.github.shawxingkwok:kt-util:1.0.0\u0026#34; Document # GitHub repo # "},{"id":2,"href":"/ITWorks/docs/androidutil/","title":"Android Util","section":"Docs","content":" Effect # Your browser doesn't support embedded videos, but don't worry, you can download it and watch it with your favorite video player! Setup # implementation \u0026#34;io.github.shawxingkwok:android-util:1.0.0\u0026#34; Document # GitHub repo # "},{"id":3,"href":"/ITWorks/docs/kdatastore/cn/","title":"中文","section":"KDataStore","content":" KDataStore # 不同存储方案对比 # SharedPreferences MMKV DataStore KDataStore 机制 写入时先更新内存 commit 同步写入磁盘, 但堵塞主线程 1.4 ms 一般通过 apply 异步写入不论写入结果如何，通知监听 先读取到系统级别的内存同步不堵塞读写每隔一段时间后台异步写入磁盘 异步写入磁盘，成功后更新内存。通过 Flow 异步观察。 响应时间 2.1 ms 基于 DataStore 先读取到应用级别的内存 同步不堵塞读写数据更新时异步写入磁盘，包括备份文件。 采取事务(transactional) No, 但采用了 synchronized 操作和备份文件以改善 后续校验数据，尝试恢复，不行则删除 Yes Yes 读取中遇 IOException 返回默认值 返回默认值 自行 catch 处理 从备份文件中取 写入中遇 IOException 用未写入该数据的备份文件替换。 如用 commit, 可通过返回的 false 获悉 后续校验数据，尝试恢复，不行则删除。 自行 catch 处理 记录，下次启动时从备份文件中更新 CorruptionException 用空文件替换 后续校验数据，尝试恢复，不行则删除 自行 catch 处理 已通过复制备份文件数据处理 多进程共享 自行封装入 ContentResolver 支持 处于 alpha 阶段 DataStore 正式支持之后 加密 自行封装 支持 自行封装 支持 类型 常见基本类型 + String + Set\u0026lt;String\u0026gt; 常见基本类型 + String + Set\u0026lt;String\u0026gt; + Parcelable 常见基本类型 + String + Set\u0026lt;String\u0026gt; 常见基本类型 + String + enum + Serializable + KtSerializable + 自定义 额外信息 ANR前一刻更新的数据不会丢失 断电或者系统崩溃后容易丢失很多数据 见表格下方 微配置，调用方便 同时支持单项数据的 nullability (可空性) 和 default (默认值) 初启动时间为 10 ms，但数据显著增加并不会影响多少。如果介意亦可在 Application 中(或startup) 里异步启动 比较新， 但基于 DataStore 且代码较少, 仅 TODO 行， 即时有 Bug 也比较少。 以上测试结果采用 30 份 7(key length) * 20(value length) 的 String 数据。\n基础用法预览 # TODO\n配置 # 迁移 (Migration) # KDataStore 内置 appContext 供你获取其他存储仓库，如 SharedPreferences, MMKV, DataStore 等。\n这份中文版本主要为初期的宣传考虑，其他作品并不会写中文版本和 Java 扩展。 关于其他地方的存储方案分析，绝大多数对比都严重遗漏和偏颇，大多数测试都有严重错误。 官网相对准确，但经常掩盖缺点，建议配合 ChatGpt 查阅分析。 GitHub repo # "},{"id":4,"href":"/ITWorks/docs/androidutilview/","title":"Android Util-view","section":"Docs","content":" Effect # Your browser doesn't support embedded videos, but don't worry, you can download it and watch it with your favorite video player! Setup # Add this part directly, rather than insert messily. Groovy //region shawxingkwok: android-util-view android.lintOptions.disable \u0026#39;NonConstantResourceId\u0026#39; tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach{ kotlinOptions.freeCompilerArgs += \u0026#34;-Xcontext-receivers\u0026#34; } dependencies { implementation \u0026#39;io.github.shawxingkwok:kt-util:1.0.0\u0026#39; implementation \u0026#39;io.github.shawxingkwok:android-util-view:1.0.0\u0026#39; } //endregion Kotlin //region shawxingkwok: android-util-view android.lintOptions.disable(\u0026#34;NonConstantResourceId\u0026#34;) tasks.withType\u0026lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompile\u0026gt;().configureEach { kotlinOptions.freeCompilerArgs += \u0026#34;-Xcontext-receivers\u0026#34; } dependencies { implementation(\u0026#34;io.github.shawxingkwok:kt-util:1.0.0\u0026#34;) implementation(\u0026#34;io.github.shawxingkwok:android-util-view:1.0.0\u0026#34;) } //endregion Document # GitHub repo # "}]