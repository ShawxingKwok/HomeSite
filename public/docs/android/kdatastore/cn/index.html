<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="这份中文版本和 Java 扩展主要用作初期宣传，其他作品并不会有。 在支持 IOS 之后会移到 Multiplatform mobile 分组中。 本地快捷存储方案对比 # SharedPreferences MMKV DataStore KDataStore 机制 同步读写 commit 堵塞当前线程 apply 不堵塞，但不知道是否成功写入磁盘。 不论是否成功写入，都更新内存，通知监听 先读取到系统级别的内存 同步不堵塞读写 后台定时异步写入磁盘 异步读写，写入成功后更新内存。
通过 Flow 异步观察。 基于 DataStore 先读取到应用级别的内存 同步不堵塞读写 数据更新时异步写入磁盘，包括备份文件。 性能 启动: 2.1ms commit: 2.4ms 启动: 2.6ms 响应: 8.0ms 启动: 18.1ms 文件显著增加时影响不大 读取中遇 IOException 返回默认值 返回默认值 自行 catch 处理 从备份文件中取 写入中遇 IOException 用未写入该数据的备份文件替换，且不再写入。
如用 commit, 可通过返回的 false 获悉 后续校验数据，尝试恢复，不行则删除。 记录，下次启动时从备份文件中更新 Corruption
Exception 用空文件替换 通过复制备份文件数据处理 多进程 自行封装 支持 处于 alpha 阶段 DataStore 正式支持之后 多平台 不支持 不支持 加密 自行封装 支持 自行封装 需引入其他加密库 类型安全 否 否 是 是 除常见基本类型, String, Set&lt;String&gt; 外的类型支持 Parcelable 自定义">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="中文" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://shawxingkwok.github.io/ITWorks/docs/android/kdatastore/cn/" />
<title>中文 | ITWorks</title>
<link rel="manifest" href="/ITWorks/manifest.json">
<link rel="icon" href="/ITWorks/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/ITWorks/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/ITWorks/flexsearch.min.js"></script>
  <script defer src="/ITWorks/en.search.min.bf6233f1ea84f163320ef57973942ccc8414475133bfcf9cdefd1f66dffffeaf.js" integrity="sha256-v2Iz8eqE8WMyDvV5c5QszIQUR1Ezv8&#43;c3v0fZt///q8=" crossorigin="anonymous"></script>
<link rel="alternate" type="application/rss+xml" href="https://shawxingkwok.github.io/ITWorks/docs/android/kdatastore/cn/index.xml" title="ITWorks" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/ITWorks/"><span>ITWorks</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Multiplatform</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/multiplatform/kt-util/" class="">Kt util</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Jvm</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f25bd71e28f95a08738fe572911bbd65" class="toggle"  />
    <label for="section-f25bd71e28f95a08738fe572911bbd65" class="flex justify-between">
      <a href="/ITWorks/docs/jvm/tracer/" class="">Tracer</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/setup/" class="">Setup</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Usage</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/usage/annotations/" class="">Annotations</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/usage/naming-rules/" class="">Naming rules</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/usage/details/" class="">Details</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/usage/notes/" class="">Notes</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/usage/demo/" class="">Demo</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-df9c64161b156bfffd3c37819ba87474" class="toggle"  />
    <label for="section-df9c64161b156bfffd3c37819ba87474" class="flex justify-between">
      <a href="/ITWorks/docs/jvm/tracer/road-map/" class="">Road map</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/road-map/short-term/" class="">Short term</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/road-map/long-term/" class="">Long term</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/road-map/new-syntax/" class="">New syntax</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Extensions</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/jvm/tracer/extensions/android/" class="">Android</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Android</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/android/util-core/" class="">Util-core</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/android/util-view/" class="">Util-view</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-48404a5524d1704bcb4add35c067ddd2" class="toggle" checked />
    <label for="section-48404a5524d1704bcb4add35c067ddd2" class="flex justify-between">
      <a role="button" class="">KDataStore</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/android/kdatastore/en/" class="">English</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/ITWorks/docs/android/kdatastore/cn/" class="active">中文</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>








<br>


  
<ul>
  
  <li>
    <a href="/ITWorks/post/about/"  >
        About
      </a>
  </li>
  
  <li>
    <a href="https://github.com/ShawxingKwok"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="mailto:ShawxingKwok@126.com"  target="_blank" rel="noopener">
        Email
      </a>
  </li>
  
  <li>
    <a href="/ITWorks/post/license/"  >
        License
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/ITWorks/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>中文</strong>

  <label for="toc-control">
    
    <img src="/ITWorks/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#本地快捷存储方案对比">本地快捷存储方案对比</a></li>
    <li><a href="#基础用法">基础用法</a>
      <ul>
        <li><a href="#ui-展示">UI 展示</a></li>
        <li><a href="#建模">建模</a></li>
        <li><a href="#调用">调用</a></li>
      </ul>
    </li>
    <li><a href="#配置">配置</a>
      <ul>
        <li><a href="#根目录">根目录</a></li>
        <li><a href="#模型模块">模型模块</a></li>
        <li><a href="#调用方">调用方</a></li>
      </ul>
    </li>
    <li><a href="#类型支持">类型支持</a></li>
    <li><a href="#迁移">迁移</a></li>
    <li><a href="#可选参数">可选参数</a></li>
    <li><a href="#重置">重置</a>
      <ul>
        <li><a href="#全部">全部</a></li>
        <li><a href="#局部">局部</a></li>
      </ul>
    </li>
    <li><a href="#快速启动">快速启动</a></li>
    <li><a href="#a-hrefhttpsgithubcomshawxingkwokkdatastore-target_blankgithub-仓库a"><a href="https://github.com/ShawxingKwok/KDataStore" target="_blank">GitHub 仓库</a></a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><blockquote class="book-hint warning">
  这份中文版本和 <code>Java</code> 扩展主要用作初期宣传，其他作品并不会有。
</blockquote>

<blockquote class="book-hint warning">
  在支持 <code>IOS</code> 之后会移到 <code>Multiplatform mobile</code> 分组中。
</blockquote>

<h1 id="本地快捷存储方案对比">
  本地快捷存储方案对比
  <a class="anchor" href="#%e6%9c%ac%e5%9c%b0%e5%bf%ab%e6%8d%b7%e5%ad%98%e5%82%a8%e6%96%b9%e6%a1%88%e5%af%b9%e6%af%94">#</a>
</h1>
<table>
<tr>
    <th></th>
    <th>SharedPreferences</th>
    <th>MMKV</th>
    <th>DataStore</th>
    <th>KDataStore</th>
</tr>
<tr>
    <td>机制</td>
    <td>
        同步读写
        <br><br>
        <span style="color:red"> <code>commit</code> 堵塞当前线程</span>
        <br> <code>apply</code> 不堵塞，<span style="color:red">但不知道是否成功写入磁盘。</span>
        <br><br><span style="color:red">不论是否成功写入，都更新内存，通知监听</span>
    </td>
    <td> 
        先读取到系统级别的内存
        <br><br><span style="color: green; ">同步不堵塞读写</span>
        <br><br>后台定时异步写入磁盘 
    </td>
    <td> 异步读写，写入成功后更新内存。<br><br>通过 Flow 异步观察。</td>
    <td> 
        基于 DataStore 
        <br><br> 先读取到应用级别的内存 
        <br><br> <span style="color: green; ">同步不堵塞读写</span>
        <br><br>数据更新时异步写入磁盘，包括备份文件。 
    </td>
</tr>
<tr>
    <td>性能</td>
    <td>启动: 2.1ms <br> <code>commit</code>: 2.4ms </td>
    <td>启动: 2.6ms</td>
    <td>响应: 8.0ms</td>
    <td><span style="color: red; ">启动: 18.1ms</span> <br> 文件显著增加时影响不大</td>
</tr>
<tr>
    <td>读取中遇 IOException</td>
    <td>返回默认值</td>
    <td>返回默认值</td>
    <td rowspan="3">自行 catch 处理</td>
    <td><span style="color: green; ">从备份文件中取</span></td>
</tr>
<tr>
    <td>写入中遇 IOException</td>
    <td>用未写入该数据的备份文件替换，且不再写入。<br><br> 如用 commit, 可通过返回的 false 获悉</td>
    <td rowspan="2">后续校验数据，尝试恢复，不行则删除。</td>
    <td><span style="color: green; ">记录，下次启动时从备份文件中更新</span></td>
</tr>
<tr>
    <td> Corruption<br>Exception </td>
    <td> <span style="color: red; ">用空文件替换</span> </td>
    <td> <span style="color: green; ">通过复制备份文件数据处理</span> </td>
</tr>
<tr>
    <td>多进程</td>
    <td>自行封装</td>
    <td> <span style="color: green; ">支持</span> </td>
    <td rowspan="2">处于 alpha 阶段</td>
    <td rowspan="2">DataStore 正式支持之后</td>
</tr>
<tr>
    <td>多平台</td>
    <td><span style="color: red; ">不支持</span></td>
    <td> <span style="color: red; ">不支持</span> </td>
</tr>
<tr>
    <td>加密</td>
    <td>自行封装</td>
    <td><span style="color: green; ">支持</span></td>
    <td>自行封装</td>
    <td> <span style="color: green; ">需引入其他加密库</span> </td>
</tr>
<tr>
    <td>类型安全</td>
    <td>否</td>
    <td>否</td>
    <td><span style="color: green; ">是</span></td>
    <td><span style="color: green; ">是</span></td>
</tr>
<tr>
    <td>除常见基本类型, String, Set&lt;String&gt; 外的类型支持</td>
    <td></td>
    <td> <span style="color: green; ">Parcelable</span></td>
    <td><span style="color: green; ">自定义</span><br>但需放在独立的 DataStore 中</td>
    <td> <span style="color: green; ">Kt Serializable (包括常见存储类型）<br><br>自定义</span></td>
</tr>
<tr>
    <td>额外优点</td>
    <td></td>
    <td> 
        <span style="color: green; ">ANR前一刻更新的数据不会丢失</span> 
    </td>
    <td></td>
    <td>
        <span style="color: green; "> 建模简单，调用方便 <br><br> 体积小，jar on Android side 仅 8 kb </span>
    </td>
</tr>
<tr>
    <td>额外缺点</td>
    <td></td>
    <td><span style="color: red; ">断电或者系统崩溃后容易丢失很多数据</span></td>
    <td></td>
    <td><span style="color: red; "> 比较新 </span> 
        <br><br> <span style="color: red; ">建模时只能使用 Kotlin, </span> 只会 Java 的同学需稍掌握一点 Kotlin 知识。
    </td>
</tr>
</table>
<p>以上测试结果采用 30 份 7(key length) * 20(value length) 的 String 数据，机型魅族18s。代码在<a href="https://github.com/ShawxingKwok/KDataStore/archive/refs/heads/master.zip">源码</a>中 api 的 androidTest。</p>
<blockquote class="book-hint warning">
  关于其他地方的存储方案对比分析，绝大多数都有严重错误。
官网相对准确，但也很片面。如想探究，建议自己测试并查阅源码。
</blockquote>

<h1 id="基础用法">
  基础用法
  <a class="anchor" href="#%e5%9f%ba%e7%a1%80%e7%94%a8%e6%b3%95">#</a>
</h1>
<p>用 Dark theme 举例</p>
<h2 id="ui-展示">
  UI 展示
  <a class="anchor" href="#ui-%e5%b1%95%e7%a4%ba">#</a>
</h2>
<video height="200" controls>
  <source src="../effect.mov" type="video/mp4">
</video>
<h2 id="建模">
  建模
  <a class="anchor" href="#%e5%bb%ba%e6%a8%a1">#</a>
</h2>
<p>单独分出一个 <code>Android</code> 模块, 常见命名为 <code>settings</code>。 （后续的文档均按照 <code>settings</code>）
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../model.png alt="" />
</div>
<br></p>
<p>关于 <code>KDSFlow</code>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../kdsFlowExpect.png alt="" />
</div>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../kdsFlowActual.png alt="" />
</div></p>
<blockquote class="book-hint warning">
  其中的 <code>liveData</code> 为 <code>Android</code> 专供，在后续的其他平台上并不支持。
</blockquote>

<h2 id="调用">
  调用
  <a class="anchor" href="#%e8%b0%83%e7%94%a8">#</a>
</h2>
<p>在其他模块中调用




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-Preview" id="tabs-Preview-0" checked="checked" />
  <label for="tabs-Preview-0">view-kt</label>
  <div class="book-tabs-content markdown-inner"><ol>
<li>在 <code>Activity</code>/<code>BasicActivity</code> 中观察<code>Flow</code>/<code>LiveData</code>，绑定主题。</li>
<li><code>checked RadioButton</code> 会随用户点击自动变化，根据 <code>isDarkMOde.value</code> 设置起始状态即可，不用绑定。</li>
<li>在 <code>RadioGroup</code> 监听中更新存值。</li>
</ol>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../kt_basic_usage.png alt="" />
</div>
<blockquote class="book-hint info">
  在 <code>Fragment</code> 中观察 <code>Flow</code> 时建议采用
<a href="https://shawxingkwok.github.io/ITWorks/docs/android/util-view/#flowcollectonresume" target="_blank">collectOnResume</a>。
</blockquote>
</div><input type="radio" class="toggle" name="tabs-Preview" id="tabs-Preview-1"  />
  <label for="tabs-Preview-1">view-java</label>
  <div class="book-tabs-content markdown-inner"><ol>
<li>在 <code>Activity</code>/<code>BasicActivity</code> 中观察 <code>LiveData</code>，绑定主题。</li>
<li><code>checked RadioButton</code> 会随用户点击自动变化，根据 <code>isDarkMode().getValue()</code> 设置起始状态即可，不用绑定。</li>
<li>在 <code>RadioGroup</code> 监听中更新存值。</li>
</ol>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../java_basic_usage.png alt="" />
</div>
</div><input type="radio" class="toggle" name="tabs-Preview" id="tabs-Preview-2"  />
  <label for="tabs-Preview-2">compose</label>
  <div class="book-tabs-content markdown-inner"><p>将 <code>State</code> 和主题绑定</p>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../composeTheme.png alt="" />
</div>
<p><code>RadioButton</code>处更新存值</p>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../composeRadioButton.png alt="" />
</div>
</div></div>
</p>
<h1 id="配置">
  配置
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae">#</a>
</h1>
<p>配置相应 <code>build.gradle</code>, 或可见<a href="#release">源码</a>中的 demo。</p>
<h2 id="根目录">
  根目录
  <a class="anchor" href="#%e6%a0%b9%e7%9b%ae%e5%bd%95">#</a>
</h2>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-root plugins" id="tabs-root plugins-0" checked="checked" />
  <label for="tabs-root plugins-0">Groovy</label>
  <div class="book-tabs-content markdown-inner"><pre tabindex="0"><code>plugins{
    ...
    id &#39;org.jetbrains.kotlin.plugin.serialization&#39; version &#34;$version_kt&#34; apply false
}
</code></pre></div><input type="radio" class="toggle" name="tabs-root plugins" id="tabs-root plugins-1"  />
  <label for="tabs-root plugins-1">Kts</label>
  <div class="book-tabs-content markdown-inner"><pre tabindex="0"><code>plugins{
    ...
    id (&#34;org.jetbrains.kotlin.plugin.serialization&#34;) version &#34;$version_kt&#34; apply false
}
</code></pre></div></div>

<h2 id="模型模块">
  模型模块
  <a class="anchor" href="#%e6%a8%a1%e5%9e%8b%e6%a8%a1%e5%9d%97">#</a>
</h2>
<p>单独分出一个 module, 常见命名为 <code>settings</code>, （如果不采纳，后续的 <code>settings</code> 命名则一并更改）
language 选择 <strong>kotlin</strong> 而非 java。</p>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-settings plugins" id="tabs-settings plugins-0" checked="checked" />
  <label for="tabs-settings plugins-0">Groovy</label>
  <div class="book-tabs-content markdown-inner"><pre tabindex="0"><code>plugins {
    ...
    id &#39;kotlinx-serialization&#39;
}

dependencies {
    ...
    implementation &#39;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.1&#39;
    implementation &#39;io.github.shawxingkwok:kt-util:1.0.0&#39;
    implementation &#39;io.github.shawxingkwok:android-util-core:1.0.0&#39;
    implementation &#39;io.github.shawxingkwok:kdatastore:1.0.0&#39;
}
</code></pre></div><input type="radio" class="toggle" name="tabs-settings plugins" id="tabs-settings plugins-1"  />
  <label for="tabs-settings plugins-1">Kts</label>
  <div class="book-tabs-content markdown-inner"><pre tabindex="0"><code>plugins {
    ...
    id (&#34;kotlinx-serialization&#34;)
}

dependencies {
    ...
    implementation (&#34;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.1&#34;)
    implementation (&#34;io.github.shawxingkwok:kt-util:1.0.0&#34;)
    implementation (&#34;io.github.shawxingkwok:android-util-core:1.0.0&#34;)
    implementation (&#34;io.github.shawxingkwok:kdatastore:1.0.0&#34;)
}
</code></pre></div></div>

<h2 id="调用方">
  调用方
  <a class="anchor" href="#%e8%b0%83%e7%94%a8%e6%96%b9">#</a>
</h2>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-caller side" id="tabs-caller side-0" checked="checked" />
  <label for="tabs-caller side-0">Groovy</label>
  <div class="book-tabs-content markdown-inner"><div class="book-tabs"><input type="radio" class="toggle" name="tabs-Groovy" id="tabs-Groovy-0" checked="checked" />
  <label for="tabs-Groovy-0">view-kt</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jetbrains</span><span class="o">.</span><span class="na">kotlin</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">KotlinCompile</span><span class="o">).</span><span class="na">configureEach</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">kotlinOptions</span><span class="o">.</span><span class="na">freeCompilerArgs</span> <span class="o">+=</span> <span class="s2">&#34;-Xcontext-receivers&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="s1">&#39;io.github.shawxingkwok:android-util-view:1.0.0&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="s1">&#39;io.github.shawxingkwok:kdatastore:1.0.0&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="nf">project</span><span class="o">(</span><span class="s1">&#39;:settings&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></div><input type="radio" class="toggle" name="tabs-Groovy" id="tabs-Groovy-1"  />
  <label for="tabs-Groovy-1">view-java / compose</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">dependencies</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="s1">&#39;io.github.shawxingkwok:kdatastore:1.0.0&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="nf">project</span><span class="o">(</span><span class="s1">&#39;:settings&#39;</span><span class="o">)</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></div></div>
</div><input type="radio" class="toggle" name="tabs-caller side" id="tabs-caller side-1"  />
  <label for="tabs-caller side-1">Kts</label>
  <div class="book-tabs-content markdown-inner"><div class="book-tabs"><input type="radio" class="toggle" name="tabs-Kts" id="tabs-Kts-0" checked="checked" />
  <label for="tabs-Kts-0">view-kt</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="n">tasks</span><span class="p">.</span><span class="n">withType</span><span class="p">&lt;</span><span class="n">org</span><span class="p">.</span><span class="n">jetbrains</span><span class="p">.</span><span class="n">kotlin</span><span class="p">.</span><span class="n">gradle</span><span class="p">.</span><span class="n">tasks</span><span class="p">.</span><span class="n">KotlinCompile</span><span class="p">&gt;().</span><span class="n">configureEach</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">kotlinOptions</span><span class="p">.</span><span class="n">freeCompilerArgs</span> <span class="o">+=</span> <span class="s2">&#34;-Xcontext-receivers&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="p">(</span><span class="s2">&#34;io.github.implementation (&#34;</span><span class="n">io</span><span class="p">.</span><span class="n">github</span><span class="p">.</span><span class="n">shawxingkwok</span><span class="p">:</span><span class="n">kdatastore</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">0</span><span class="s2">&#34;)shawxingkwok:android-util-view:1.0.0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="p">(</span><span class="n">project</span><span class="p">(</span><span class="s2">&#34;:settings&#34;</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div><input type="radio" class="toggle" name="tabs-Kts" id="tabs-Kts-1"  />
  <label for="tabs-Kts-1">view-java / compose</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="n">dependencies</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="p">(</span><span class="s2">&#34;io.github.shawxingkwok:kdatastore:1.0.0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span> <span class="p">(</span><span class="n">project</span><span class="p">(</span><span class="s2">&#34;:settings&#34;</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div></div>
</div></div>

<h1 id="类型支持">
  类型支持
  <a class="anchor" href="#%e7%b1%bb%e5%9e%8b%e6%94%af%e6%8c%81">#</a>
</h1>
<p><code>Kt Serializable</code> 为 Kotlin 官方出的序列化工具，用法类似 <code>Java Serializable</code>, 但多平台，且速度快两倍多。
被 <code>Serializable</code> 标记的 <code>class</code>,
基本类型，<code>enum</code>, <code>Pair</code>, <code>IntArray</code>, <code>List</code> 的默认实现等等均可视为 <code>Kt Serializable</code>,
详见 <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md" target="_blank">kotlinx.serialization</a>。</p>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../types.png alt="" />
</div>
<ul>
<li><code>Not nullable</code> 时需声明默认值。</li>
<li><code>Nullable</code> 时默认值被限制为 <code>null</code>。</li>
<li>自定义时需实现与 <code>Kt Serializable</code> 之间的相互转换。</li>
</ul>
<h1 id="迁移">
  迁移
  <a class="anchor" href="#%e8%bf%81%e7%a7%bb">#</a>
</h1>
<p>类比下图格式（判断存在 -&gt; 迁移 -&gt; 删除）从其他存储仓库迁移过来。</p>
<p>比如取自 <code>SharedPreferences</code>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../migration.png alt="" />
</div>
<br></p>
<p>此外内置 <code>delete</code>, <code>exist</code> 两个函数辅助从 <code>KDataStore</code> 迁移到别处。




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-exist" id="tabs-exist-0" checked="checked" />
  <label for="tabs-exist-0">Kt</label>
  <div class="book-tabs-content markdown-inner"><div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../delete_exist_kt.png alt="" />
</div>
</div><input type="radio" class="toggle" name="tabs-exist" id="tabs-exist-1"  />
  <label for="tabs-exist-1">Java</label>
  <div class="book-tabs-content markdown-inner"><div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../delete_exist_java.png alt="" />
</div>
</div></div>

警告以防止误用，并无任何异常风险。</p>
<h1 id="可选参数">
  可选参数
  <a class="anchor" href="#%e5%8f%af%e9%80%89%e5%8f%82%e6%95%b0">#</a>
</h1>
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../args.png alt="" />
</div>
<p>加密部分需引入其他加密库，自制 cipher。
<div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../cipher.png alt="" />
</div></p>
<blockquote class="book-hint info">
  Android 在 api 29 版本开始引入了沙盒机制，实现了数据隔离，相对已经很安全了。
</blockquote>

<h1 id="重置">
  重置
  <a class="anchor" href="#%e9%87%8d%e7%bd%ae">#</a>
</h1>
<h2 id="全部">
  全部
  <a class="anchor" href="#%e5%85%a8%e9%83%a8">#</a>
</h2>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-wholeReset" id="tabs-wholeReset-0" checked="checked" />
  <label for="tabs-wholeReset-0">Kt</label>
  <div class="book-tabs-content markdown-inner"><div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../wholeResetKt.png alt="" />
</div>
</div><input type="radio" class="toggle" name="tabs-wholeReset" id="tabs-wholeReset-1"  />
  <label for="tabs-wholeReset-1">Java</label>
  <div class="book-tabs-content markdown-inner"><div style="border:1px solid black; padding-left:10px; padding-top:10px; padding-right:10px;">
    <img src=../wholeResetJava.png alt="" />
</div>
</div></div>

<h2 id="局部">
  局部
  <a class="anchor" href="#%e5%b1%80%e9%83%a8">#</a>
</h2>
<p>比如重置声明过的 <code>isDarkMode</code>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-partialReset" id="tabs-partialReset-0" checked="checked" />
  <label for="tabs-partialReset-0">Kt</label>
  <div class="book-tabs-content markdown-inner"><pre tabindex="0"><code>Settings.isDarkMode.reset()
</code></pre></div><input type="radio" class="toggle" name="tabs-partialReset" id="tabs-partialReset-1"  />
  <label for="tabs-partialReset-1">Java</label>
  <div class="book-tabs-content markdown-inner"><pre tabindex="0"><code>Settings.isDarkMode().reset();
</code></pre></div></div>
</p>
<h1 id="快速启动">
  快速启动
  <a class="anchor" href="#%e5%bf%ab%e9%80%9f%e5%90%af%e5%8a%a8">#</a>
</h1>
<p>如果你介意这点启动时间(<strong>5～30 ms</strong>), 可先行在 <code>Application</code> 中异步调用 <code>Settings</code>。</p>
<h1 id="a-hrefhttpsgithubcomshawxingkwokkdatastore-target_blankgithub-仓库a">
  <a href="https://github.com/ShawxingKwok/KDataStore" target="_blank">GitHub 仓库</a>
  <a class="anchor" href="#a-hrefhttpsgithubcomshawxingkwokkdatastore-target_blankgithub-%e4%bb%93%e5%ba%93a">#</a>
</h1>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">




  <div>
    <a class="flex align-center" href="https://github.com/ShawxingKwok/ITWorks/blob/main/content/docs/android/kdatastore/cn/_index.md" target="_blank" rel="noopener">
      <img src="/ITWorks/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#本地快捷存储方案对比">本地快捷存储方案对比</a></li>
    <li><a href="#基础用法">基础用法</a>
      <ul>
        <li><a href="#ui-展示">UI 展示</a></li>
        <li><a href="#建模">建模</a></li>
        <li><a href="#调用">调用</a></li>
      </ul>
    </li>
    <li><a href="#配置">配置</a>
      <ul>
        <li><a href="#根目录">根目录</a></li>
        <li><a href="#模型模块">模型模块</a></li>
        <li><a href="#调用方">调用方</a></li>
      </ul>
    </li>
    <li><a href="#类型支持">类型支持</a></li>
    <li><a href="#迁移">迁移</a></li>
    <li><a href="#可选参数">可选参数</a></li>
    <li><a href="#重置">重置</a>
      <ul>
        <li><a href="#全部">全部</a></li>
        <li><a href="#局部">局部</a></li>
      </ul>
    </li>
    <li><a href="#快速启动">快速启动</a></li>
    <li><a href="#a-hrefhttpsgithubcomshawxingkwokkdatastore-target_blankgithub-仓库a"><a href="https://github.com/ShawxingKwok/KDataStore" target="_blank">GitHub 仓库</a></a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












