<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Abstract # MVB is my new architecture standing for Model-View-Bridge. Now, it only has an Android implementation, but the pattern is applicable to every platform that supports Kotlin. The UI part uses the traditional View without DataBinding, and the Kt part hides ViewModel, resulting in much less code and clearer logic.
Other points:
Compose is the most concise declarative UI framework, and also the most flexible in terms of custom views."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Android"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://shawxingkwok.github.io/ITWorks/docs/multiplatform/mvb/android/"><title>Android | ITWorks</title>
<link rel=manifest href=/ITWorks/manifest.json><link rel=icon href=/ITWorks/favicon.png type=image/x-icon><link rel=stylesheet href=/ITWorks/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/ITWorks/flexsearch.min.js></script><script defer src=/ITWorks/en.search.min.ed93006d887fe830a40f983c60c8998c83bbf91c5e1c77f0b572ac20996fdaa9.js integrity="sha256-7ZMAbYh/6DCkD5g8YMiZjIO7+RxeHHfwtXKsIJlv2qk=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://shawxingkwok.github.io/ITWorks/docs/multiplatform/mvb/android/index.xml title=ITWorks></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/ITWorks/><span>ITWorks</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Multiplatform</span><ul><li><a href=/ITWorks/docs/multiplatform/phone/>Phone</a><ul></ul></li><li><a href=/ITWorks/docs/multiplatform/kt-util/>Kt util</a><ul></ul></li><li><span>MVB</span><ul><li><a href=/ITWorks/docs/multiplatform/mvb/android/ class=active>Android</a><ul></ul></li><li><a href=/ITWorks/docs/multiplatform/mvb/proposal/>New UI design proposal</a><ul></ul></li></ul></li></ul></li><li><span>Jvm</span><ul><li><input type=checkbox id=section-f25bd71e28f95a08738fe572911bbd65 class=toggle>
<label for=section-f25bd71e28f95a08738fe572911bbd65 class="flex justify-between"><a role=button>Tracer</a></label><ul><li><a href=/ITWorks/docs/jvm/tracer/setup/>Setup</a><ul></ul></li><li><span>Usage</span><ul><li><a href=/ITWorks/docs/jvm/tracer/usage/annotations/>Annotations</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/naming-rules/>Naming rules</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/details/>Details</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/notes/>Notes</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/practice/>Practice</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/test/>Test</a><ul></ul></li></ul></li><li><input type=checkbox id=section-df9c64161b156bfffd3c37819ba87474 class=toggle>
<label for=section-df9c64161b156bfffd3c37819ba87474 class="flex justify-between"><a role=button>Road map</a></label><ul><li><a href=/ITWorks/docs/jvm/tracer/road-map/short-term/>Short term</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/road-map/long-term/>Long term</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/road-map/With-kcp/>With Kcp</a><ul></ul></li></ul></li><li><span>Extensions</span><ul><li><a href=/ITWorks/docs/jvm/tracer/extensions/android/>Android-view</a><ul></ul></li></ul></li><li><a href=https://github.com/ShawxingKwok/Tracer target=_blank>Github repo</a><ul></ul></li></ul></li></ul></li><li><span>Android</span><ul><li><a href=/ITWorks/docs/android/util-core/>Util-core</a><ul></ul></li><li><a href=/ITWorks/docs/android/util-view/>Util-view</a><ul></ul></li><li><input type=checkbox id=section-48404a5524d1704bcb4add35c067ddd2 class=toggle>
<label for=section-48404a5524d1704bcb4add35c067ddd2 class="flex justify-between"><a role=button>KDataStore</a></label><ul><li><a href=/ITWorks/docs/android/kdatastore/en/>English</a><ul></ul></li><li><a href=/ITWorks/docs/android/kdatastore/cn/>中文</a><ul></ul></li></ul></li></ul></li></ul><br><ul><li><a href=/ITWorks/post/about/>About</a></li><li><a href=/ITWorks/post/sponsor/>Sponsor</a></li><li><a href=https://github.com/ShawxingKwok target=_blank rel=noopener>Github</a></li><li><a href=mailto:ShawxingKwok@126.com target=_blank rel=noopener>Email</a></li><li><a href=/ITWorks/post/license/>License</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/ITWorks/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Android</strong>
<label for=toc-control><img src=/ITWorks/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#setup>Setup</a></li><li><a href=#usage>Usage</a><ul><li><a href=#rmb>rmb</a></li><li><a href=#save>save</a><ul><li><a href=#direct>Direct</a></li><li><a href=#transform>Transform</a></li><li><a href=#parcelable-component>Parcelable component</a></li></ul></li><li><a href=#observe>observe</a></li><li><a href=#mvbscope>mvbScope</a></li><li><a href=#format>Format</a><ul><li><a href=#utils-and-components-for-reusable-and-complex-parts>Utils and Components for reusable and complex parts</a></li><li><a href=#static-processing>Static processing</a></li><li><a href=#bridge>Bridge</a></li><li><a href=#fixed-listeners>Fixed listeners</a></li></ul></li></ul></li><li><a href=#a-hrefhttpsgithubcomshawxingkwokmvb-target_blank-github-repoa><a href=https://github.com/ShawxingKwok/MVB target=_blank>GitHub repo</a></a></li></ul></nav></aside></header><article class=markdown><h1 id=abstract>Abstract
<a class=anchor href=#abstract>#</a></h1><p><code>MVB</code> is my new architecture standing for <code>Model-View-Bridge</code>. Now, it only has an Android implementation,
but the pattern is applicable to every platform that supports Kotlin. The UI part uses the traditional <code>View</code> without
<code>DataBinding</code>, and the Kt part hides <code>ViewModel</code>, resulting in much less code and clearer logic.</p><p>Other points:</p><ul><li><p><code>Compose</code> is the most concise declarative UI framework, and also the most flexible in terms of custom views. However,
its recombination mechanism inevitably reconstructs massive objects, resulting in its low upper performance limit.</p></li><li><p>Regarding <code>navigation parameters</code> for <code>Activity</code> / <code>Fragment</code>, I have a proposal on
<a href=https://www.reddit.com/r/androiddev/comments/15pa5qf/proposal_android_could_support_activityfragment/ target=_blank>Reddit</a>.</p></li><li><p><code>RecyclerView.Adapter</code> is the most common among components with complex writing styles, whereas my encapsulated
<a href=/ITWorks/docs/android/util-view/#krecyclerviewadapter target=_blank>KRecyclerViewAdapter</a> arranges list items as <code>Compose</code>.</p></li><li><p>For the UI part, I have a <a href=../proposal target=_blank>new design pattern proposal</a> of which the expected effect is
much better than <code>Compose</code> and <code>Flutter</code>.</p></li></ul><p>Overall, I suggest <code>MVB</code> if you haven&rsquo;t switched to <code>Compose</code> from <code>View</code> at present. In the future, there would be a new
imperative UI mode based on that <a href=../proposal target=_blank>proposal</a> implementation in which <code>MVB</code> mode would still work.</p><h1 id=setup>Setup
<a class=anchor href=#setup>#</a></h1><div class=book-tabs><input type=radio class=toggle name="tabs-%!s(<nil>)" id="tabs-%!s(<nil>)-0" checked>
<label for="tabs-%!s(<nil>)-0">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>android</span><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>buildFeatures</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>viewBinding</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tasks</span><span class=o>.</span><span class=na>withType</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=na>jetbrains</span><span class=o>.</span><span class=na>kotlin</span><span class=o>.</span><span class=na>gradle</span><span class=o>.</span><span class=na>tasks</span><span class=o>.</span><span class=na>KotlinCompile</span><span class=o>).</span><span class=na>configureEach</span><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>kotlinOptions</span><span class=o>.</span><span class=na>freeCompilerArgs</span> <span class=o>+=</span> <span class=s2>&#34;-Xcontext-receivers&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;io.github.shawxingkwok:android-util-view:1.0.8&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;io.github.shawxingkwok:mvb-android:1.0.7&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></div><input type=radio class=toggle name="tabs-%!s(<nil>)" id="tabs-%!s(<nil>)-1">
<label for="tabs-%!s(<nil>)-1">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>android</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>buildFeatures</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>viewBinding</span> <span class=p>=</span> <span class=k>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tasks</span><span class=p>.</span><span class=n>withType</span><span class=p>&lt;</span><span class=n>org</span><span class=p>.</span><span class=n>jetbrains</span><span class=p>.</span><span class=n>kotlin</span><span class=p>.</span><span class=n>gradle</span><span class=p>.</span><span class=n>tasks</span><span class=p>.</span><span class=n>KotlinCompile</span><span class=p>&gt;().</span><span class=n>configureEach</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>kotlinOptions</span><span class=p>.</span><span class=n>freeCompilerArgs</span> <span class=o>+=</span> <span class=s2>&#34;-Xcontext-receivers&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dependencies</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span><span class=p>(</span><span class=s2>&#34;io.github.shawxingkwok:android-util-view:1.0.8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span><span class=p>(</span><span class=s2>&#34;io.github.shawxingkwok:mvb-android:1.0.7&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>`</span>
</span></span></code></pre></div></div></div><h1 id=usage>Usage
<a class=anchor href=#usage>#</a></h1><blockquote class="book-hint info">Examples are all with <code>Fragment</code>, but also applicable on <code>ComponentActivity</code> (a super class of <code>AppCompatAtivity</code>).</blockquote><h2 id=rmb>rmb
<a class=anchor href=#rmb>#</a></h2><p>This is the abbreviation of <code>remember</code>, meaning the value is alive across the configuration change (e.g. rotation).
Switch from the traditional way as below.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=rmb.png alt></div></p><p style=text-align:center>↓</p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=rmb_.png alt></div><blockquote class="book-hint info">Initialization of the property declared with <code>val</code> is <code>synchronized</code>.</blockquote><h2 id=save>save
<a class=anchor href=#save>#</a></h2><h3 id=direct>Direct
<a class=anchor href=#direct>#</a></h3><p>Saved values are not only alive across the configuration change, but also restorable from the killed process.</p><p><div class=book-tabs><input type=radio class=toggle name=tabs-save id=tabs-save-0 checked>
<label for=tabs-save-0>Common</label><div class="book-tabs-content markdown-inner"><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveParcelable.png alt></div><p style=text-align:center>↓</p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveParcelable_.png alt></div></div><input type=radio class=toggle name=tabs-save id=tabs-save-1>
<label for=tabs-save-1>Flow</label><div class="book-tabs-content markdown-inner"><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveFlow.png alt></div><p style=text-align:center>↓</p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveFlow_.png alt></div></div><input type=radio class=toggle name=tabs-save id=tabs-save-2>
<label for=tabs-save-2>LiveData</label><div class="book-tabs-content markdown-inner"><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveLiveData.png alt></div><p style=text-align:center>↓</p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveLiveData_.png alt></div></div></div><blockquote class="book-hint warning">Saved value types should follow <a href=https://developer.android.com/kotlin/parcelize target=_blank>Parcelize</a> rules.
Please note that there is a mistake in the official document. <code>Set</code> is actually saved as <code>Serialziable</code> and can&rsquo;t keep
<code>Parcelable</code>.</blockquote><blockquote class="book-hint info">I suggest to use <code>Flow</code> instead of <code>LiveData</code>, though it takes some time to learn.</blockquote><blockquote class="book-hint info">Rules below are same to <code>saveMutableStateFlow</code>, <code>saveMutableSharedFlow</code>, <code>saveMutableLiveData</code>, and not limited with
<code>val</code> / <code>var</code>.</blockquote></p><h3 id=transform>Transform
<a class=anchor href=#transform>#</a></h3><p>You could also save values with any type by appending <code>transform</code> after <code>save</code> with the converted values following
<a href=https://developer.android.com/kotlin/parcelize target=_blank>Parcelize</a> rules.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveWithTransform.png alt></div><blockquote class="book-hint warning">The lambda <code>convert</code> keeps alive after its lifecycle owner is killed by the application. Therefore,
don&rsquo;t reference callables from its owner to avoid memory leaks.</blockquote></p><h3 id=parcelable-component>Parcelable component
<a class=anchor href=#parcelable-component>#</a></h3><p>Sometimes you need to pass <code>KClass&lt;out Parcelable></code> as the parcelable component. Besides, there could be no more than 1
parcelable subtype.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=saveWithParcelableComponent.png alt></div></p><h2 id=observe>observe
<a class=anchor href=#observe>#</a></h2><p>The delegated values via <code>rmb</code> / <code>save</code> are easily observable if it&rsquo;s <code>Flow</code> / <code>LiveData</code>. The latter <code>observe</code> lambdas
are active between every <code>onStart</code> and <code>onStop</code>, which is generally used for linking <code>value</code> to <code>UI state</code>.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=observe.png alt></div></p><p style=text-align:center>↓</p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=observe_.png alt></div><h2 id=mvbscope>mvbScope
<a class=anchor href=#mvbscope>#</a></h2><p>This is <code>viewModelScope</code> of the hidden <code>MVBViewModel</code>. This <code>coroutineScope</code> is not affected by the configuration change,
and cancelled only when its owner <code>ComponentActivity</code> / <code>Fragment</code> is killed by <code>user presses back</code> or <code>low memory</code>.
Besides, it&rsquo;s not static but actually an extensive property. Check out the source code, and you will find there is no
memory leak.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=mvbScope.png alt></div></p><h2 id=format>Format
<a class=anchor href=#format>#</a></h2><p>Take an example of simulating the stopwatch page in the IOS clock with concise code below.</p><video height=400 controls>
<source src=stopwatch.mov type=video/mp4></video><h3 id=utils-and-components-for-reusable-and-complex-parts>Utils and Components for reusable and complex parts
<a class=anchor href=#utils-and-components-for-reusable-and-complex-parts>#</a></h3><p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=stopwatchUtil.png alt></div><br>See <a href=/ITWorks/docs/android/util-view/#krecyclerviewadapter target=_blank>KRecyclerViewAdapter</a> if it&rsquo;s new to you.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=stopwatchAdapter.png alt></div></p><h3 id=static-processing>Static processing
<a class=anchor href=#static-processing>#</a></h3><p>For example, declaring components and enabling them in <code>ComponentActivity.onCreate</code> / <code>Fragment.onViewCreated</code><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=staticProcessing.png alt></div></p><h3 id=bridge>Bridge
<a class=anchor href=#bridge>#</a></h3><p>Declaring variable data sources via <code>rmb</code> and <code>save</code>, and linking them to <code>UI state</code> via appending <code>observe</code>.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=bridge1.png alt></div><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=bridge2.png alt></div></p><h3 id=fixed-listeners>Fixed listeners
<a class=anchor href=#fixed-listeners>#</a></h3><p>I suggest to put fixed listeners here or below, allowing for variating data source or navigating to other pages.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=fixedListeners.png alt></div></p><p>Or this style<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=fixedListenersWithSeparateActions.png alt></div></p><blockquote class="book-hint info">Some functions from other libraries are independent with <code>MVB</code>, e.g.
<a href=https://dylancaicoding.github.io/ViewBindingKTX/#/en/ target=_blank>binding(XxBinding::bind)</a>,
<a href=/ITWorks/docs/android/util-view/#viewonclick target=_blank>onClick</a>,
and <a href=/ITWorks/docs/multiplatform/kt-util/html/-kt-util/pers.shawxingkwok.ktutil/update-if.html target=_blank>updateIf</a>.</blockquote><h1 id=a-hrefhttpsgithubcomshawxingkwokmvb-target_blank-github-repoa><a href=https://github.com/ShawxingKwok/MVB target=_blank>GitHub repo</a>
<a class=anchor href=#a-hrefhttpsgithubcomshawxingkwokmvb-target_blank-github-repoa>#</a></h1></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/ShawxingKwok/ITWorks/blob/main/content/docs/multiplatform/mvb/android/_index.md target=_blank rel=noopener><img src=/ITWorks/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#setup>Setup</a></li><li><a href=#usage>Usage</a><ul><li><a href=#rmb>rmb</a></li><li><a href=#save>save</a><ul><li><a href=#direct>Direct</a></li><li><a href=#transform>Transform</a></li><li><a href=#parcelable-component>Parcelable component</a></li></ul></li><li><a href=#observe>observe</a></li><li><a href=#mvbscope>mvbScope</a></li><li><a href=#format>Format</a><ul><li><a href=#utils-and-components-for-reusable-and-complex-parts>Utils and Components for reusable and complex parts</a></li><li><a href=#static-processing>Static processing</a></li><li><a href=#bridge>Bridge</a></li><li><a href=#fixed-listeners>Fixed listeners</a></li></ul></li></ul></li><li><a href=#a-hrefhttpsgithubcomshawxingkwokmvb-target_blank-github-repoa><a href=https://github.com/ShawxingKwok/MVB target=_blank>GitHub repo</a></a></li></ul></nav></div></aside></main></body></html>