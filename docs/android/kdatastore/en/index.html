<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Abstract # KDataStore is my local persistent Android storage solution based on Jetpack&rsquo;s DataStore. The emphasis on optimizations is as follows:
Singleton mode. Generating key through delegation. Adapting MutableStateFlow for real-time observation, synchronous reading and writing with memory, and asynchronous writing to disk. Backing up data to handle exceptions. Supports extensive types, e.g. Kotlin Serializable, Customized, Nullable. See the GitHub repository (includes demo) for more information.
Java support is for the initial promotion and not considered in my other works."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="English"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://shawxingkwok.github.io/ITWorks/docs/android/kdatastore/en/"><title>English | ITWorks</title>
<link rel=manifest href=/ITWorks/manifest.json><link rel=icon href=/ITWorks/favicon.png type=image/x-icon><link rel=stylesheet href=/ITWorks/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/ITWorks/flexsearch.min.js></script><script defer src=/ITWorks/en.search.min.ed93006d887fe830a40f983c60c8998c83bbf91c5e1c77f0b572ac20996fdaa9.js integrity="sha256-7ZMAbYh/6DCkD5g8YMiZjIO7+RxeHHfwtXKsIJlv2qk=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://shawxingkwok.github.io/ITWorks/docs/android/kdatastore/en/index.xml title=ITWorks></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/ITWorks/><span>ITWorks</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Multiplatform</span><ul><li><a href=/ITWorks/docs/multiplatform/phone/>Phone</a><ul></ul></li><li><a href=/ITWorks/docs/multiplatform/kt-util/>Kt util</a><ul></ul></li><li><span>MVB</span><ul><li><a href=/ITWorks/docs/multiplatform/mvb/android/>Android</a><ul></ul></li><li><a href=/ITWorks/docs/multiplatform/mvb/proposal/>New UI design proposal</a><ul></ul></li></ul></li></ul></li><li><span>Jvm</span><ul><li><input type=checkbox id=section-f25bd71e28f95a08738fe572911bbd65 class=toggle>
<label for=section-f25bd71e28f95a08738fe572911bbd65 class="flex justify-between"><a role=button>Tracer</a></label><ul><li><a href=/ITWorks/docs/jvm/tracer/setup/>Setup</a><ul></ul></li><li><span>Usage</span><ul><li><a href=/ITWorks/docs/jvm/tracer/usage/annotations/>Annotations</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/naming-rules/>Naming rules</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/details/>Details</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/notes/>Notes</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/practice/>Practice</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/usage/test/>Test</a><ul></ul></li></ul></li><li><input type=checkbox id=section-df9c64161b156bfffd3c37819ba87474 class=toggle>
<label for=section-df9c64161b156bfffd3c37819ba87474 class="flex justify-between"><a role=button>Road map</a></label><ul><li><a href=/ITWorks/docs/jvm/tracer/road-map/short-term/>Short term</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/road-map/long-term/>Long term</a><ul></ul></li><li><a href=/ITWorks/docs/jvm/tracer/road-map/With-kcp/>With Kcp</a><ul></ul></li></ul></li><li><span>Extensions</span><ul><li><a href=/ITWorks/docs/jvm/tracer/extensions/android/>Android-view</a><ul></ul></li></ul></li><li><a href=https://github.com/ShawxingKwok/Tracer target=_blank>Github repo</a><ul></ul></li></ul></li></ul></li><li><span>Android</span><ul><li><a href=/ITWorks/docs/android/util-core/>Util-core</a><ul></ul></li><li><a href=/ITWorks/docs/android/util-view/>Util-view</a><ul></ul></li><li><input type=checkbox id=section-48404a5524d1704bcb4add35c067ddd2 class=toggle checked>
<label for=section-48404a5524d1704bcb4add35c067ddd2 class="flex justify-between"><a role=button>KDataStore</a></label><ul><li><a href=/ITWorks/docs/android/kdatastore/en/ class=active>English</a><ul></ul></li><li><a href=/ITWorks/docs/android/kdatastore/cn/>中文</a><ul></ul></li></ul></li></ul></li></ul><br><ul><li><a href=/ITWorks/post/about/>About</a></li><li><a href=/ITWorks/post/sponsor/>Sponsor</a></li><li><a href=https://github.com/ShawxingKwok target=_blank rel=noopener>Github</a></li><li><a href=mailto:ShawxingKwok@126.com target=_blank rel=noopener>Email</a></li><li><a href=/ITWorks/post/license/>License</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/ITWorks/svg/menu.svg class=book-icon alt=Menu>
</label><strong>English</strong>
<label for=toc-control><img src=/ITWorks/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#competitor-comparison>Competitor comparison</a></li><li><a href=#basic-usage>Basic Usage</a><ul><li><a href=#model>Model</a></li><li><a href=#call>Call</a></li></ul></li><li><a href=#setup>Setup</a><ul><li><a href=#root-directory>Root Directory</a></li><li><a href=#model-module>Model module</a></li><li><a href=#caller-side>Caller Side</a></li></ul></li><li><a href=#type-support>Type Support</a></li><li><a href=#migration>Migration</a></li><li><a href=#optional-arguments>Optional arguments</a></li><li><a href=#reset>Reset</a><ul><li><a href=#all>All</a></li><li><a href=#partial>Partial</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=abstract>Abstract
<a class=anchor href=#abstract>#</a></h1><p><code>KDataStore</code> is my <strong>local persistent Android storage solution</strong> based on Jetpack&rsquo;s <a href=https://developer.android.com/topic/libraries/architecture/datastore target=_blank>DataStore</a>.
The emphasis on optimizations is as follows:</p><ul><li>Singleton mode.</li><li>Generating <code>key</code> through delegation.</li><li>Adapting <code>MutableStateFlow</code> for real-time observation, synchronous reading and writing with memory, and asynchronous writing to disk.</li><li>Backing up data to handle exceptions.</li><li>Supports extensive types, e.g. <code>Kotlin Serializable</code>, <code>Customized</code>, <code>Nullable</code>.</li></ul><p>See the <a href=https://github.com/ShawxingKwok/KDataStore target=_blank>GitHub repository</a> (includes demo) for more information.</p><blockquote class="book-hint warning"><code>Java</code> support is for the initial promotion and not considered in my other works.</blockquote><blockquote class="book-hint warning">This page will be moved to <code>Multiplatform</code> after <code>IOS</code> support.</blockquote><h1 id=competitor-comparison>Competitor comparison
<a class=anchor href=#competitor-comparison>#</a></h1><table><tr><th></th><th><a href=https://developer.android.com/training/data-storage/shared-preferences target=_blank>SharedPreferences</a></th><th><a href=https://github.com/Tencent/MMKV#readme target=_blank>MMKV</a></th><th><a href=https://developer.android.com/topic/libraries/architecture/datastore target=_blank>DataStore</a></th><th>KDataStore</th></tr><tr><td>Performance</td><td>Startup: 2.5ms<br><br>Reading: negligible time consumption.<br><br><span style=color:red>Writing with <code>commit</code>: blocking for 2.3ms</span><br><br>Writing time consumption with <code>apply</code>is negligible, <span style=color:red>but it is unsure if the data has been successfully written to disk asynchronously.</span></td><td>Startup: 2.3ms<br><br>Reading and writing: negligible time consumption</td><td>All are performed asynchronously, so only <span style=color:red>response time consumption is measured: 8.6ms</span></td><td><span style=color:red>Startup: 13.5ms</span><br>This impact is not significant when the file size increases substantially, and it can be also resolved by calling the <code>KDataStore subclass </code>asynchronously in the <code>Application</code>.<br><br>Reading and writing time consumption is negligible.</td></tr><tr><td>Type safety</td><td>No</td><td>No</td><td><span style=color:green>Yes</span></td><td><span style=color:green>Yes</span></td></tr><tr><td>Support for types other than common basic types, <code>String</code>, and <code>Set&lt;String></code></td><td></td><td><span style=color:green>Parcelable</span></td><td><span style=color:green>Customizable</span><br>However, it needs to be placed in an independent <code>DataStore</code></td><td><span style=color:green>Kt<code>Serializable</code> (including common storage types）<br><br>Customizable</span></td></tr><tr><td>Exception during reading</td><td colspan=2><span style=color:red>Returns a empty <code>HashMap</code>, which means returning defaults for all</span></td><td rowspan=2>Manual catch</td><td><span style=color:green>Gets from backup file</span></td></tr><tr><td>IOException during writing</td><td>Replaces with the backup file without the data, and <span style=color:red>do not write again.</span><br><br>Returns <code>false</code> if via <code>commit</code></td><td><span style=color:red>Only <code>catch</code> without handling.</span></td><td><span style=color:green>Records at once. Update from backup file at next startup</span></td></tr><tr><td>Multiprocess</td><td>Manual encapsulation</td><td><span style=color:green>Supported</span></td><td rowspan=2>In <code>1.1.0-alpha</code>stage</td><td rowspan=2>After <code>DataStore 1.1.0</code> releases</td></tr><tr><td>Multiplatform</td><td><span style=color:red>Not supported</span></td><td><span style=color:green>Supported</span></td></tr><tr><td>Crypto</td><td>Manual encapsulation</td><td><span style=color:green>Supported</span></td><td>Manual encapsulation</td><td><span style=color:green>You need to choose a crypto protocol and customize a <code>cipher</code>.</span></td></tr><tr><td>Additional advantages</td><td></td><td><span style=color:green>Data updated before <code>ANR</code> will not be lost</span></td><td></td><td><span style=color:green>Small size, jar on Android side is only 12.6 kb</span></td></tr><tr><td>Additional disadvantages</td><td></td><td><span style=color:red>After a power outage or system crash, a lot of data is likely to be lost</span></td><td></td><td><span style=color:red>Quite new</span><br><br><span style=color:red>Modeling requires Kotlin.</span> Java is only supported on caller side.</td></tr></table><p>The test results above are based on 30 sets of String data of Meizu 18s. Source code is in <a href=https://github.com/ShawxingKwok/KDataStore target=_blank>KDataStore</a>.benchmark.</p><blockquote class="book-hint warning">There are serious errors in most storage scheme comparison analysises from other information sources.
The official website is relatively accurate, but very one-sided.
If you want to explore further, I recommend you test it yourself and view the source code for deep exploration.</blockquote><h1 id=basic-usage>Basic Usage
<a class=anchor href=#basic-usage>#</a></h1><video height=200 controls>
<source src=../effect.mov type=video/mp4></video><p>Take the example of switching <code>darkTheme</code> with the stored <code>Boolean</code>.</p><h2 id=model>Model
<a class=anchor href=#model>#</a></h2><p>Set an independent <code>Android</code> module, commonly named <code>settings</code>.<blockquote class="book-hint info">All namings in the following documents refer to <code>settings</code>.</blockquote><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../model.png alt></div><br></p><p>About <code>KDSFlow</code><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../kdsFlowExpect.png alt></div></p><p><code>actual KDSFlow</code> on Android<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../kdsFlowActual.png alt></div></p><h2 id=call>Call
<a class=anchor href=#call>#</a></h2><p>Call in other modules<div class=book-tabs><input type=radio class=toggle name=tabs-Preview id=tabs-Preview-0 checked>
<label for=tabs-Preview-0>view-kt</label><div class="book-tabs-content markdown-inner"><ol><li>Observe <code>Flow</code>/<code>LiveData</code> in <code>Activity</code>/<code>BasicActivity</code> and bind the <code>theme</code>.</li><li>Checked <code>RadioButton</code> will change with the user&rsquo;s click. Just set the initial state according to
<code>isDarkMode.value</code> rather than bind.</li><li>Update the stored value in the <code>RadioGroup</code> listener.</li></ol><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../kt_basic_usage.png alt></div><blockquote class="book-hint info"><a href=/ITWorks/docs/android/util-view/#flowcollectonresume target=_blank>collectOnResume</a> is recommended to observe <code>Flow</code> in <code>Fragment</code>,
of which the <code>setup</code> is included in the following.</blockquote></div><input type=radio class=toggle name=tabs-Preview id=tabs-Preview-1>
<label for=tabs-Preview-1>view-java</label><div class="book-tabs-content markdown-inner"><ol><li>Observe <code>LiveData</code> in <code>Activity</code>/<code>BasicActivity</code> and bind the <code>theme</code>.</li><li>Checked <code>RadioButton</code> will change with the user&rsquo;s click. Just set the initial state according to
<code>isDarkMode.value</code> rather than bind.</li><li>Update the stored value in the <code>RadioGroup</code> listener.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../java_basic_usage.png alt></div></li></ol></div><input type=radio class=toggle name=tabs-Preview id=tabs-Preview-2>
<label for=tabs-Preview-2>compose</label><div class="book-tabs-content markdown-inner"><p>Bind <code>state</code> and <code>theme</code></p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../composeTheme.png alt></div><p>Update stored value at <code>RadioButton</code></p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../composeRadioButton.png alt></div></div></div></p><h1 id=setup>Setup
<a class=anchor href=#setup>#</a></h1><p>Configure <code>build.gradle</code>/<code>build.gradle.kts</code> as below, or reference the demo in <a href=https://github.com/ShawxingKwok/KDataStore target=_blank>Github</a>
which uses <a href=https://developer.android.com/build/migrate-to-catalogs target=_blank>version catalog</a>.</p><h2 id=root-directory>Root Directory
<a class=anchor href=#root-directory>#</a></h2><div class=book-tabs><input type=radio class=toggle name="tabs-root plugins" id="tabs-root plugins-0" checked>
<label for="tabs-root plugins-0">Groovy</label><div class="book-tabs-content markdown-inner"><pre tabindex=0><code>plugins{
    ...
    id &#39;org.jetbrains.kotlin.plugin.serialization&#39; version &#34;$version_kt&#34; apply false
}
</code></pre></div><input type=radio class=toggle name="tabs-root plugins" id="tabs-root plugins-1">
<label for="tabs-root plugins-1">Kotlin</label><div class="book-tabs-content markdown-inner"><pre tabindex=0><code>plugins{
    ...
    id (&#34;org.jetbrains.kotlin.plugin.serialization&#34;) version &#34;$version_kt&#34; apply false
}
</code></pre></div></div><h2 id=model-module>Model module
<a class=anchor href=#model-module>#</a></h2><div class=book-tabs><input type=radio class=toggle name="tabs-settings plugins" id="tabs-settings plugins-0" checked>
<label for="tabs-settings plugins-0">Groovy</label><div class="book-tabs-content markdown-inner"><pre tabindex=0><code>plugins {
    ...
    id &#39;kotlinx-serialization&#39;
}

dependencies {
    ...
    implementation &#39;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.1&#39; 
    implementation &#39;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.1&#39;
    implementation &#39;io.github.shawxingkwok:kt-util:1.0.2&#39;
    implementation &#39;io.github.shawxingkwok:kdatastore:1.0.0&#39;
}
</code></pre></div><input type=radio class=toggle name="tabs-settings plugins" id="tabs-settings plugins-1">
<label for="tabs-settings plugins-1">Kotlin</label><div class="book-tabs-content markdown-inner"><pre tabindex=0><code>plugins {
    ...
    id (&#34;kotlinx-serialization&#34;)
}

dependencies {
    ...
    implementation (&#34;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.1&#34;)
    implementation (&#34;io.github.shawxingkwok:kt-util:1.0.2&#34;)
    implementation (&#34;io.github.shawxingkwok:kdatastore:1.0.0&#34;)
}
</code></pre></div></div><h2 id=caller-side>Caller Side
<a class=anchor href=#caller-side>#</a></h2><div class=book-tabs><input type=radio class=toggle name="tabs-caller side" id="tabs-caller side-0" checked>
<label for="tabs-caller side-0">Groovy</label><div class="book-tabs-content markdown-inner"><div class=book-tabs><input type=radio class=toggle name=tabs-Groovy id=tabs-Groovy-0 checked>
<label for=tabs-Groovy-0>view-kt</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>tasks</span><span class=o>.</span><span class=na>withType</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=na>jetbrains</span><span class=o>.</span><span class=na>kotlin</span><span class=o>.</span><span class=na>gradle</span><span class=o>.</span><span class=na>tasks</span><span class=o>.</span><span class=na>KotlinCompile</span><span class=o>).</span><span class=na>configureEach</span><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>kotlinOptions</span><span class=o>.</span><span class=na>freeCompilerArgs</span> <span class=o>+=</span> <span class=s2>&#34;-Xcontext-receivers&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;io.github.shawxingkwok:android-util-view:1.0.8&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;io.github.shawxingkwok:kdatastore:1.0.0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=nf>project</span><span class=o>(</span><span class=s1>&#39;:modelModuleName&#39;</span><span class=o>)</span> <span class=c1>// or remote library
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div></div><input type=radio class=toggle name=tabs-Groovy id=tabs-Groovy-1>
<label for=tabs-Groovy-1>view-java / compose</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>dependencies</span><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>   <span class=n>implementation</span> <span class=s1>&#39;io.github.shawxingkwok:kdatastore:1.0.0&#39;</span>
</span></span><span class=line><span class=cl>   <span class=n>implementation</span> <span class=nf>project</span><span class=o>(</span><span class=s1>&#39;:modelModuleName&#39;</span><span class=o>)</span> <span class=c1>// or remote library
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div></div></div></div><input type=radio class=toggle name="tabs-caller side" id="tabs-caller side-1">
<label for="tabs-caller side-1">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=book-tabs><input type=radio class=toggle name=tabs-Kotlin id=tabs-Kotlin-0 checked>
<label for=tabs-Kotlin-0>view-kt</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>tasks</span><span class=p>.</span><span class=n>withType</span><span class=p>&lt;</span><span class=n>org</span><span class=p>.</span><span class=n>jetbrains</span><span class=p>.</span><span class=n>kotlin</span><span class=p>.</span><span class=n>gradle</span><span class=p>.</span><span class=n>tasks</span><span class=p>.</span><span class=n>KotlinCompile</span><span class=p>&gt;().</span><span class=n>configureEach</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>kotlinOptions</span><span class=p>.</span><span class=n>freeCompilerArgs</span> <span class=o>+=</span> <span class=s2>&#34;-Xcontext-receivers&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dependencies</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=p>(</span><span class=s2>&#34;io.github.shawxingkwok:kdatastore:1.0.0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=p>(</span><span class=s2>&#34;io.github.shawxingkwok:android-util-view:1.0.8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=p>(</span><span class=n>project</span><span class=p>(</span><span class=s2>&#34;:modelModuleName&#34;</span><span class=p>))</span> <span class=c1>// or remote library
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div></div><input type=radio class=toggle name=tabs-Kotlin id=tabs-Kotlin-1>
<label for=tabs-Kotlin-1>view-java / compose</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>dependencies</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=p>(</span><span class=s2>&#34;io.github.shawxingkwok:kdatastore:1.0.0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=p>(</span><span class=n>project</span><span class=p>(</span><span class=s2>&#34;:modelModuleName&#34;</span><span class=p>))</span> <span class=c1>// or remote library
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div></div></div></div></div><blockquote class="book-hint warning">Include <code>KDataStoreInitializer::class.java</code> in <code>dependencies</code>, in case this caller module introduced
<a href="https://developer.android.com/topic/libraries/app-startup?hl=zh-cn" target=_blank>startup-runtime</a>.</blockquote><h1 id=type-support>Type Support
<a class=anchor href=#type-support>#</a></h1><p><a href=https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md target=_blank>kotlinx.serialization</a>
usage is similar to <code>Java Serializable</code>, but multiplatform and more than twice as fast.
Classes annotated with <code>Serializable</code>, basic types, <code>enum</code>, <code>Pair</code>, <code>IntArray</code>, <code>List</code>&rsquo;s default implementation and some others
can be considered as <code>Serializable</code>.</p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../types.png alt></div><ul><li>When <code>non-null</code>, a default value must be declared.</li><li>When <code>nullable</code>, the default value is restricted to <code>null</code>.</li></ul><blockquote class="book-hint warning"><p>Edit in a stored object would not trigger the disk update.</p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../note_update.png alt></div></blockquote><h1 id=migration>Migration
<a class=anchor href=#migration>#</a></h1><p>Migrate from other storage repositories with this format (judge existence -> migrate -> delete) in which <code>appContext</code>
is from <code>KDataStore</code>.</p><p>Take the example of migrating from <code>SharedPreferences</code>.<div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../migration.png alt></div><br></p><p>Additionally, there are two built-in functions, <code>delete</code> and <code>exist</code>, that assist in migrating from <code>KDataStore</code> to other places.<div class=book-tabs><input type=radio class=toggle name=tabs-exist id=tabs-exist-0 checked>
<label for=tabs-exist-0>Kt</label><div class="book-tabs-content markdown-inner"><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../delete_exist_kt.png alt></div></div><input type=radio class=toggle name=tabs-exist id=tabs-exist-1>
<label for=tabs-exist-1>Java</label><div class="book-tabs-content markdown-inner"><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../delete_exist_java.png alt></div></div></div>Warning is for preventing misuse rather than exception risks.</p><h1 id=optional-arguments>Optional arguments
<a class=anchor href=#optional-arguments>#</a></h1><p><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../args.png alt></div><br><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../cipher.png alt></div></p><p>For the <code>cipher</code> part, you need to choose a crypto protocol from <code>Java</code> standard library,
or other libraries to customize it.</p><blockquote class="book-hint info">Data isolation was introduced in Android API 29, making it relatively safe without crypto which
approximately doubles the startup time.</blockquote><h1 id=reset>Reset
<a class=anchor href=#reset>#</a></h1><h2 id=all>All
<a class=anchor href=#all>#</a></h2><div class=book-tabs><input type=radio class=toggle name=tabs-wholeReset id=tabs-wholeReset-0 checked>
<label for=tabs-wholeReset-0>Kt</label><div class="book-tabs-content markdown-inner"><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../wholeResetKt.png alt></div></div><input type=radio class=toggle name=tabs-wholeReset id=tabs-wholeReset-1>
<label for=tabs-wholeReset-1>Java</label><div class="book-tabs-content markdown-inner"><div style="border:1px solid #000;padding-left:10px;padding-top:10px;padding-right:10px"><img src=../wholeResetJava.png alt></div></div></div><h2 id=partial>Partial
<a class=anchor href=#partial>#</a></h2><p>Take the example of <code>isDarkMode</code>.<div class=book-tabs><input type=radio class=toggle name=tabs-partialReset id=tabs-partialReset-0 checked>
<label for=tabs-partialReset-0>Kt</label><div class="book-tabs-content markdown-inner"><pre tabindex=0><code>Settings.isDarkMode.reset()
</code></pre></div><input type=radio class=toggle name=tabs-partialReset id=tabs-partialReset-1>
<label for=tabs-partialReset-1>Java</label><div class="book-tabs-content markdown-inner"><pre tabindex=0><code>Settings.isDarkMode().reset();
</code></pre></div></div></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/ShawxingKwok/ITWorks/blob/main/content/docs/android/kdatastore/en/_index.md target=_blank rel=noopener><img src=/ITWorks/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#competitor-comparison>Competitor comparison</a></li><li><a href=#basic-usage>Basic Usage</a><ul><li><a href=#model>Model</a></li><li><a href=#call>Call</a></li></ul></li><li><a href=#setup>Setup</a><ul><li><a href=#root-directory>Root Directory</a></li><li><a href=#model-module>Model module</a></li><li><a href=#caller-side>Caller Side</a></li></ul></li><li><a href=#type-support>Type Support</a></li><li><a href=#migration>Migration</a></li><li><a href=#optional-arguments>Optional arguments</a></li><li><a href=#reset>Reset</a><ul><li><a href=#all>All</a></li><li><a href=#partial>Partial</a></li></ul></li></ul></nav></div></aside></main></body></html>